<form action="/" accept-charset="UTF-8" method="POST" class="w-50">
    <label for="searchtext" class="form-label">Station Search</label>

    <div class="input-group">
        <span class="input-group-text" id="searchtext_prompt">Name, ID, Region, etc:</span>
        <input type="text" class="form-control" name="searchtext" id="searchtext" placeholder="Station..."/>
        <button class="btn btn-primary" type="submit">Search</button>
    </div>
</form>

<%
   if defined? request_url
       uri = URI.parse(request_url)
       uri.scheme = "webcal"
   end
%>

<% if (tide_results.count > 0 rescue false) %>
<table class="table table-striped table-hover caption-top">
    <caption>Tide Stations</caption>
    <thead class="table-light"><tr>
        <th scope="col">ID</th>
        <th scope="col">Name</th>
        <th scope="col">Region</th>
        <th scope="col">.ICS</th>
        <th scope="col" class="text-right">Refine</th>
    </tr></thead>
<tbody>
<% tide_results.each do |r| %>
    <tr>
    <th scope="row"><a href="https://tidesandcurrents.noaa.gov/stationhome.html?id=<%= r['stationId'] %>"><%= r['stationId'] %></a></th>
    <td><%= r["commonName"] %></td>
    <td><%= r["region"]%></td>

    <% uri.path = "/tides/#{r['stationId']}.ics"
       webcal_url = uri.to_s %>
    <td><a href="<%= webcal_url %>" target="_blank">webcal</a></td>

    <td>

        <div class="btn-group dropdown">
            <a href="#" class="dropdown-toggle" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                Radius
            </a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <form action="/" method="POST">
                    <label for="within" class="form-label">Any stations within</label>
                    <div class="input-group">
                        <input type="text" class="form-control" name="within" id="within" />
                        <input type="hidden" name="searchtext" value="<%= r['stationId'] %>" />
                        <span class="input-group-text" id="radius_units">mi</span>
                        <button class="btn btn-secondary btn-sm" type="submit">Search</button>
                    </div>
                </form>
            </div>
        </div>

    </td>

</tr>
<% end %>
</tbody>
</table>
<p/>
<% end %>


<% if (current_results.count > 0 rescue false) %>
<table class="table table-striped table-hover caption-top">
    <caption>Current Stations</caption>
    <thead class="table-light"><tr>
        <th scope="col">ID</th>
        <th scope="col">Depth (ft)</th>
        <th scope="col">Name</th>
        <th scope="col">.ICS</th>
        <th scope="col">Refine</th>
    </tr></thead>
<tbody>
<% current_results.each do |r| %>
<tr>
    <th scope="row"><a href="https://tidesandcurrents.noaa.gov/noaacurrents/Predictions?id=<%= r['bid'] %>"><%= r['id'] %></a></td>
    <td><%= r["depth"].to_i %></td>
    <td><%= r["name"] %></td>

    <% uri.path = "/currents/#{r['bid']}.ics"
       webcal_url = uri.to_s %>
    <td><a href="<%= webcal_url %>" target="_blank">webcal</a></td>

    <td>

        <div class="btn-group dropdown">
            <a href="#" class="dropdown-toggle" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                Radius
            </a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <form action="/" method="POST">
                    <label for="within" class="form-label">Any stations within</label>
                    <div class="input-group">
                        <input type="text" class="form-control" name="within" id="within" />
                        <input type="hidden" name="searchtext" value="<%= r['bid'] %>" />
                        <span class="input-group-text" id="radius_units">mi</span>
                        <button class="btn btn-secondary btn-sm" type="submit">Search</button>
                    </div>
                </form>
            </div>
        </div>

    </td>

</tr>
<% end %>
</tbody>
</table>
<p/>
<% end %>
